<div class="container mg-t10">
  <div class="row">
    <div class="col-12">
      <app-header title="Issuer Wallet Seeds" icon="fa-seedling">
        <button mat-mini-fab color="primary" matTooltip="Create new issuer wallet seed" (click)="createNewSeed()">
          <app-fa-icon icon="fa-plus"></app-fa-icon>
        </button>
      </app-header>
    </div>
  </div>
  <div class="row mg-y5">
    <div class="col-12">
      <mat-accordion multi>
        <mat-expansion-panel *ngFor="let issuerWalletSeed of issuerWalletSeeds; let i = index" [expanded]="i === 0">
          <mat-expansion-panel-header>
            <mat-panel-title
              ><strong>{{ getSeedName(issuerWalletSeed) }}</strong></mat-panel-title
            >
          </mat-expansion-panel-header>
          <div class="seed-content">
            <div class="flx ai-c">
              <mat-chip-list class="mg-r2">
                <mat-chip color="primary">
                  <i class="fa fa-fw fa-clock mg-r1"></i>
                  {{ issuerWalletSeed.createdDt | date: 'dd.MM.yyyy HH:mm:ss' }}
                </mat-chip>
              </mat-chip-list>
              <button type="button" mat-mini-fab color="primary" matTooltip="Derive new wallet from this seed" (click)="deriveNewWallet(issuerWalletSeed.id)">
                <i class="fa fa-fw fa-share-alt"></i>
              </button>
              <button type="button" mat-mini-fab color="primary" matTooltip="Create a new token" (click)="createNewToken(issuerWalletSeed.id)">
                <i class="fa fa-fw fa-coins"></i>
              </button>
            </div>
            <hr class="mg-y5" />
            <ng-container *ngIf="issuerWalletSeed.wallets && issuerWalletSeed.wallets.length > 0">
              <h2>Issuer wallets ({{ issuerWalletSeed.wallets.length }})</h2>
              <div class="row">
                <div class="col-5" *ngFor="let wallet of issuerWalletSeed.wallets">
                  <mat-card class="issuer-wallet">
                    <mat-card-header>
                      <div mat-card-avatar>
                        <app-svg-icon [svg]="getIcon(wallet.assetType)"></app-svg-icon>
                      </div>
                      <mat-card-title>{{ wallet.name }}</mat-card-title>
                      <mat-card-subtitle>
                        {{ IssuerWalletRoles[wallet.role] }}
                      </mat-card-subtitle>
                    </mat-card-header>
                    <mat-card-content>
                      <mat-chip-list>
                        <mat-chip selected color="primary" [appCopyClipboard]="wallet.publicAddress">
                          <span class="flx ai-c address address-m">
                            <app-fa-icon class="mg-r1" icon="fa-wallet"></app-fa-icon>
                            {{ wallet.publicAddress }}
                          </span>
                        </mat-chip>
                        <mat-chip selected color="accent" (click)="showAddressQrCode(wallet)">
                          <app-fa-icon icon="fa-qrcode"></app-fa-icon>
                        </mat-chip>
                        <mat-chip selected color="accent" (click)="goToBlockchainExplorer(wallet)">
                          <app-fa-icon icon="fa-search"></app-fa-icon>
                        </mat-chip>
                        <mat-chip selected color="accent" (click)="sendTokens(wallet)">
                          <app-fa-icon icon="fa-paper-plane"></app-fa-icon>
                        </mat-chip>
                      </mat-chip-list>
                      <mat-tab-group class="mg-t4">
                        <mat-tab label="Balance">
                          <table class="w-100" mat-table [dataSource]="getBalances(wallet)">
                            <ng-container matColumnDef="amount">
                              <th mat-header-cell *matHeaderCellDef>Amount</th>
                              <td mat-cell *matCellDef="let element">
                                {{ element.amount }}
                              </td>
                            </ng-container>

                            <ng-container matColumnDef="unitName">
                              <th mat-header-cell *matHeaderCellDef>Unit Name</th>
                              <td mat-cell *matCellDef="let element">
                                {{ element.unitName }}
                              </td>
                            </ng-container>

                            <tr mat-header-row *matHeaderRowDef="balanceColumns"></tr>
                            <tr mat-row *matRowDef="let row; columns: balanceColumns"></tr>
                          </table>
                        </mat-tab>
                        <mat-tab label="Tokens">
                          <table class="w-100" mat-table [dataSource]="wallet.tokenizedAssets">
                            <ng-container matColumnDef="name">
                              <th mat-header-cell *matHeaderCellDef>Name</th>
                              <td mat-cell *matCellDef="let element">
                                {{ element.name }}
                              </td>
                            </ng-container>

                            <ng-container matColumnDef="unitName">
                              <th mat-header-cell *matHeaderCellDef>Unit Name</th>
                              <td mat-cell *matCellDef="let element">
                                {{ element.unitName }}
                              </td>
                            </ng-container>

                            <ng-container matColumnDef="totalSupply">
                              <th mat-header-cell *matHeaderCellDef>Total Supply</th>
                              <td mat-cell *matCellDef="let element">
                                {{ element.totalSupply }}
                              </td>
                            </ng-container>

                            <ng-container matColumnDef="decimals">
                              <th mat-header-cell *matHeaderCellDef>Decimals</th>
                              <td mat-cell *matCellDef="let element">
                                {{ element.decimals }}
                              </td>
                            </ng-container>

                            <tr mat-header-row *matHeaderRowDef="tokenizedAssetColumns"></tr>
                            <tr mat-row *matRowDef="let row; columns: tokenizedAssetColumns"></tr>
                          </table>
                        </mat-tab>
                      </mat-tab-group>
                    </mat-card-content>
                  </mat-card>
                </div>
              </div>
            </ng-container>
          </div>
        </mat-expansion-panel>
      </mat-accordion>
    </div>
  </div>
</div>

<ng-template #qrTpl>
  <div class="ta-c">
    <qr-code [value]="publicAddress" size="300" errorCorrectionLevel="M"></qr-code>
  </div>
</ng-template>
